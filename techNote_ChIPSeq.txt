#######################
## ChIP-Seq pipeline ##
#######################

# environment setting

# parameters and experiment conditions
treatmentCondtions = 2 # numbers of biological replicates

blacklisted_regions








# library
library(markdown)
library(ggplot2)


# scripts 



########################
# Experiment tech note #
########################

# Coverage: For mammalian TFs and chromatin modification, such as enhancer-associated
#           histone marks, which are typically localized at specific, narrow sites and
#           have on order of thousands of binding sites, 20 million reads may be 
#           adequate (4 million reads for worm and fly TFs). Proteins with more binding
#           sites, (e.g., RNA PolII) or broader factors, including most histone markers,
#           will require more reads up to  60 million for mammalian ChIP-Seq.
#           Control samples should be sequenced significantly deeper than the ChIP ones.
#           


#####################################
# Quality matrics of sequence reads #
#####################################

# 1. FastQC - filter low quality reads

# 2. end trimming - trim the low quality nucleotides at the end
#                 - sickle, https://github.com/najoshi/sickle

# 3. library complexity - can be corrected by systematic identification and removal 
#                         of redundant reads, which is implemented in many peak
#                         callers as it may improve their specificity.
#                       - preseq package; or 
#                       - PCR bottleneck coefficient [PBC] from ENCODE tools, 
#                         https://code.google.com/p/phantompeakqualtools/
# 

##############################
# Sequence alignment/Mapping #
##############################

# - It is important to consider the percentage of uniquely mapped reads reported by 
#   the mapper. The percentage varies between organisms, and for human, mouse, or 
#   Arabidopsis ChIP-seq data, above 70% uniquely mapped reads is normal, whereas 
#   less than 50% may be cause for concern.
# - A low percentage of uniquely mapped reads often is due either to:
#           a. excessive amplification in the PCR step;
#           b. inadequate read length;
#           c. problems with the sequencing platform; 
#           d. unavoidable for some ChIPed proteins
#              (e.g., if the protein binds frequently in repetitive DNA, which also
#              is a potential cause of high numbers of "multi-mapping" reads is that
#              the protein binds frequently in regions of repeated DNA.)
# - multi-mapping could be reduced by paired-end sequencing, and multi-mmapping reads
#   will be filtered out by most peak-calling algorithms (however, they could be novel
#   binding sites.
# - the available mappers: 
#             Bowtie
#             Bowtie2 (support gapped alignment): not necessay for most ChIP-Seq
#             BWA
#             SOAP
#             MAQ



# - singal-to-noise ratio (SNR) of ChIP-Seq experiments to detect possible 
#   failure modes of ChIP-seq: 
#                      1. insufficient enrichment by immunoprecipitation step;
#                      2. poor fragment-size selection;
#                      3. insufficient sequencing depth. 
# - SNR can be checked by:
#   1. quality metrix, such as strand cross-correlation (built into some peak 
#      callers, e.g. SPP or MACS version 2);
#   2. IP enrichment estimation using CHANCE.









################
# Peak Calling #
################

# to predict the regions of the genome where the ChIPed protein is bound by
# finding regions with significant numbers of mapped reads (peaks).

# A fine balance between sensitivity and specificity depends on choosing an appropriate 
# peak-calling algorithm and normalization method

# algorithms to choose based on the type of protein ChIPed:
#   a. point-source factors such as most TFs (Box 3):
#        ChIP-seq data of point-source factors are the most abundant type, 
#        most peak callers are designed and fine-tuned for these factors.


#   b. broadly enriched factors such as histone marks (Box 4);
#
#   c. those with both characteristics such as RNA Pol II (Box 5) [20].
# 
#


# Assessment of Reproducibility

# Reproducibility of overall paterns
# 1. At least two biological replicates of each ChIP-seq experiments
# 2. Pearson correlation coefficient of the mapped read counts at each genomic position.
#    - 0.3 - 0.4 for unrelated samples
#    - > 0.9 for replicate samples in high-quality experiments
#    - it is important to remove artefact regions with high ChIP signals, such as
#      regions near centromeres, telomeres, satellite repeats, and ENCODE and 1000 
#      Genomes blacklisted regions, before computing the PCC.
#
# Reproducibility of peak level: IDR analysis - assess the rank consistency of 
# identical peaks between replicates (user-specified reproducibility, IDR = 0.05).
# It can be used for comparing and selection peak caller and identifying experiments
# with low quality.
#




############
# Analysis #
############

# A. Annotation




# B. Differetial Representation
# Methods:
#   1. simple binary overlap of two sets does not represent the optimal approach
#      when comparing peaks.
#        - BEDTools
#   2. one-qualitative-implements hypothesis testing on multiple overlapping sets 
#      of peaks, extending the two-set overlap approach.
#




# C. Motif Identificaiton & Discovery




# D. Integrative Analysis






